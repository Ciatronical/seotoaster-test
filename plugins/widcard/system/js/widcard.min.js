$(function(){checkFields();$("#idCard input, #idCard textarea").keyup(function(){""==this.value?$(".wic_"+this.name).css({display:"none"}):$(".wic_"+this.name).removeAttr("style")});$("#idCard>select").change(function(){""==this.value?$(".wic_"+this.name).css({display:"none"}):$(".wic_"+this.name).removeAttr("style")});var b=$("#industry_type li.disabled");0!=b.length&&$.each(b,function(a,c){var b=$("<li>").data("value",$(c).data("value")).text($(c).text());$("#sel_industry").append(b);$(b).prepend($("<span>").addClass("ticon-close error del-disabled fl-right").attr("title",
"Delete"));$("#industry_type li[data-value="+$(c).data("value")+"]").addClass("disabled")});$('select[name="organization_country"]').on("change",function(){var a=$('select[name="country_state"]');"US"==$(this).val()||"CA"==$(this).val()||"AU"==$(this).val()?($(".wic_country_state").removeAttr("style"),a.removeAttr("disabled"),a.empty(),i=0,$.getJSON($('input[name="toasterUrl"]').val()+"plugin/widcard/run/getStates",{countryCode:$(this).val()},function(c){$.each(c.states,function(c,b){0==i++?a.append($("<option selected>").val(c).text(b)):
a.append($("<option>").val(c).text(b))});$("#state-typed").length&&($("#state-typed").text($('select[name="country_state"] option:selected').val()),$(".span_wic_country_state").text($('select[name="country_state"] option:selected').html()))})):(a.empty(),a.attr("disabled",!0),$(".wic_country_state").css({display:"none"}));$("#state-typed").length&&$("#state-typed").text("")});$("#industry_type li").click(function(){if(5>$("#sel_industry li").length&&!0!=$(this).hasClass("disabled")){$(this).addClass("disabled");
var a=$("<li>").data("value",$(this).data("value")).text($(this).text());$("#sel_industry").append(a);$(a).prepend($("<span>").addClass("ticon-close error del-disabled fl-right").attr("title","Delete"))}});$(document).on("click",".del-disabled",function(){$("#industry_type li[data-value="+$(this).parent().data("value")+"]").removeClass("disabled");$(this).parent().remove()});$("#get-token-link").on("click",function(){$("#registration-frame").slideToggle("fast",function(){$("#idCard").animate({scrollTop:2E3},
300)})});$("#teaser_text").length&&($("#characters-limit").text(200-$("#teaser_text").val().length),$("#teaser_text").keyup(function(a){a=0;var c=$("#teaser_text").val().length;200<c?(c=$("#teaser_text").val().substr(0,200),$("#teaser_text").val(c)):a=200-c;$("#characters-limit").text(a)}));$("#idCard").on("change",'input[name="analytics"]',function(){"WA"==$(this).attr("value")?($(".webAnalyticsCodeRadio, #agreement").show(),$(".seosambaAnalyticsRadio, #noAnalyticsText").hide(),$(".sambaToken").appendTo($(".webAnalyticsCodeRadio")).show()):
"SA"==$(this).attr("value")?($(".seosambaAnalyticsRadio, .webAnalyticsCodeRadio, #noAnalyticsText").hide(),$(".sambaToken").appendTo($(".seosambaAnalyticsRadio")).show(),$(".seosambaAnalyticsRadio").show(),$("#agreement").show()):($("#noAnalyticsText").show(),$(".webAnalyticsCodeRadio, .seosambaAnalyticsRadio, .sambaToken, #agreement").hide())});$("div.webAnalyticsCodeRadio").on("change",'input[name="useGA"]',function(){$(this).is(":checked")?(void 0==$('input[name="useGA"]').data("usetext")&&$('input[name="useGA"]').data("usetext",
$("#useWAText").text()),$("#useWAText>label").text($("#useGAText").text())):($("#useGAText").hide(),$("#useWAText>label").text($('input[name="useGA"]').data("usetext")))});""!=$("input#widcardInfo").data("usega")&&($('input[name="useGA"]').attr("checked","checked"),$('input[name="useGA"]').change());""!=$("input#widcardInfo").data("analyticstype")&&$('input[name="analytics"][value="'+$("input#widcardInfo").data("analyticstype")+'"]').attr("checked","checked").change();$("#saveWebsite").on("click",
function(a){a.preventDefault();a=$("#sel_industry li");a.length&&$.each(a,function(){$("#idCard").append($("<input>").attr({type:"hidden",name:"industry_type[]"}).val($(this).data("value")))});a=$("#teaser_text");if(200<$(a).val().length){var c=$(a).position();$(a).addClass("warning");$("#scroll").animate({scrollTop:c.top-30+"px"},100);return!1}$(a).removeClass("warning");if($('input[name="agreement"]').length&&"NA"!=$('input[name="analytics"]:checked').val()&&(!$('input[name="agreement"]').is(":checked")||
!$('input[name="analytics"]').is(":checked"))){if(!$('input[name="analytics"]').is(":checked"))return showMessage("Please choose an analytics.",1),!1;if(!$('input[name="agreement"]').is(":checked"))return showMessage("Don't forget to accept the terms & conditions.",1),!1}a=$("#page-preview-image").attr("src");a=a.substr(a.lastIndexOf("/")+1);c=$("div#page-teaser-uploader-filelist").has(".ui-widget").length;"noimage.png"!=a&&!0==c&&$('input[name="imageName"]').val(a);$("#idCard").submit()});$(".wicInlineElement").hover(function(){$("span",
$(this)).show("fast")},function(){$("span",$(this)).hide("fast")});$(document).on("click",".wicInlineElement",function(){var a=$(this);$(this).width();$(this).css("font-size");var c=$(this).attr("id"),b=$(".wicInlineElement").data("secure-token");$(".wicInlineInput").length||$(this).replaceWith($("<input>").removeClass().val($(a).text()).attr({type:"text"}).addClass("wicInlineInput").blur(function(){if("wicPhone"==c){var e=$(this).val();if(/^(\+\d)*\s*(\(\d{3}\)\s*)*\d{3}(-{0,1}|\s{0,1})\d{2}(-{0,1}|\s{0,1})\d{2}$/.test(e))$(this).css("border",
"none");else return $(this).css("border","1px solid red"),!1}if(""==$(this).val())return $(".wicInlineInput").replaceWith($(a)),!1;var d=$(this).next();$(this).hide();$(d).show();$.ajax({type:"POST",url:$(a).data("url"),dataType:"json",data:{key:c,value:$(this).val(),secureToken:b},success:function(b){b=$(".wicInlineInput");$(a).attr("data-default",!1);$(".wicInlineInput").replaceWith($(a).text($(b).val()));$(d).hide()},error:function(){}})}));$(".wicInlineInput").focus();!0==$(a).data("default")&&
($(".wicInlineInput").val(""),$(".wicInlineInput").css("width",2*$(".wicInlineInput").width()+"px"));return!1});""==$('input[name="organization_name"]').val()?$("#organization-name-typed").text($("#organization-name-typed").data("deforgname")):($("#organization-name-typed").text($('input[name="organization_name"]').val()),$(".span_wic_organization_name").text($('input[name="organization_name"]').val()));$('input[name="organization_name"]').keyup(function(a){""==$('input[name="organization_name"]').val()?
$("#organization-name-typed").text($("#organization-name-typed").data("deforgname")):($("#organization-name-typed").text($('input[name="organization_name"]').val()),$(".span_wic_organization_name").text($('input[name="organization_name"]').val()))});""==$('textarea[name="organization_description"]').val()?$("#organization-description-typed").text($("#organization-description-typed").data("deforgdesc")):($("#organization-description-typed").text($('textarea[name="organization_description"]').val()),
$(".span_wic_organization_description").text($('textarea[name="organization_description"]').val()));$('textarea[name="organization_description"]').keyup(function(a){""==$('textarea[name="organization_description"]').val()?$("#organization-description-typed").text($("#organization-description-typed").data("deforgdesc")):($("#organization-description-typed").text($('textarea[name="organization_description"]').val()),$(".span_wic_organization_description").text($('textarea[name="organization_description"]').val()))});
""==$('input[name="address1"]').val()?$("#address1-typed").text($("#address1-typed").data("defaddr1")):($("#address1-typed").text($('input[name="address1"]').val()),$(".span_wic_address1").text($('input[name="address1"]').val()));$('input[name="address1"]').keyup(function(a){""==$('input[name="address1"]').val()?$("#address1-typed").text($("#address1-typed").data("defaddr1")):($("#address1-typed").text($('input[name="address1"]').val()),$(".span_wic_address1").text($('input[name="address1"]').val()))});
""!=$('input[name="email"]').val()&&$(".span_wic_email").text($('input[name="email"]').val());$('input[name="email"]').keyup(function(a){""==$('input[name="email"]').val()&&$(".span_wic_email").text($('input[name="email"]').val())});""==$('input[name="address2"]').val()?$("#address2-typed").text($("#address2-typed").data("defaddr2")):($("#address2-typed").text($('input[name="address2"]').val()),$(".span_wic_address2").text($('input[name="address2"]').val()));$('input[name="address2"]').keyup(function(a){""==
$('input[name="address2"]').val()?$("#address2-typed").text($("#address2-typed").data("defaddr2")):($("#address2-typed").text($('input[name="address2"]').val()),$(".span_wic_address2").text($('input[name="address2"]').val()))});""==$('input[name="city"]').val()?$("#city-typed").text($("#city-typed").data("defcity")):($("#city-typed").text($('input[name="city"]').val()),$(".span_wic_city").text($('input[name="city"]').val()));$('input[name="city"]').keyup(function(a){""==$('input[name="city"]').val()?
$("#city-typed").text($("#city-typed").data("defcity")):($("#city-typed").text($('input[name="city"]').val()),$(".span_wic_city").text($('input[name="city"]').val()))});void 0==$('select[name="country_state"] option:selected').val()?($("#state-typed").text(""),$(".wic_country_state").css({display:"none"})):($("#state-typed").text($('select[name="country_state"] option:selected').val()),$(".span_wic_country_state").text($('select[name="country_state"] option:selected').html()));$("body").on("click",
'select[name="country_state"]',function(){void 0==$('select[name="country_state"] option:selected').val()?$("#state-typed").text(""):($("#state-typed").text($('select[name="country_state"] option:selected').val()),$(".wic_country_state").removeAttr("style"),$(".span_wic_country_state").text($('select[name="country_state"] option:selected').html()))});void 0!=$('select[name="organization_country"] option:selected').val()?($(".span_wic_organization_country").text($('select[name="organization_country"] option:selected').html()),
$("#country-typed").text(", "+$('select[name="organization_country"] option:selected').text())):$("#country-typed").text("");$("body").on("change",'select[name="organization_country"]',function(){$(".span_wic_organization_country").text($('select[name="organization_country"] option:selected').html());$("#country-typed").text(", "+$('select[name="organization_country"] option:selected').val())});""==$('input[name="zip"]').val()?$("#zip-typed").text($("#zip-typed").data("defzip")):($("#zip-typed").text($('input[name="zip"]').val()),
$(".span_wic_zip").text($('input[name="zip"]').val()));$('input[name="zip"]').keyup(function(a){""==$('input[name="zip"]').val()?$("#zip-typed").text($("#zip-typed").data("defzip")):($("#zip-typed").text($('input[name="zip"]').val()),$(".span_wic_zip").text($('input[name="zip"]').val()))});""==$('input[name="phone"]').val()?$("#phone-typed").text($("#phone-typed").data("defphone")):($("#phone-typed").text($('input[name="phone"]').val()),$(".span_wic_phone").text($('input[name="phone"]').val()));$('input[name="phone"]').keyup(function(a){""==
$('input[name="phone"]').val()?$("#phone-typed").text($("#phone-typed").data("defphone")):($("#phone-typed").text($('input[name="phone"]').val()),$(".span_wic_phone").text($('input[name="phone"]').val()))});""==$('input[name="h1"]').val()?$("#website-url-typed").text($("#website-url-typed").data("defurl")):($("#website-url-typed").text($('input[name="h1"]').val()),$(".span_wic_h1").text($('input[name="h1"]').val()));$('input[name="h1"]').keyup(function(a){""==$('input[name="h1"]').val()?$("#website-url-typed").text($("#website-url-typed").data("defurl")):
($("#website-url-typed").text($('input[name="h1"]').val()),$(".span_wic_h1").text($('input[name="h1"]').val()))});$('#social-account input[type="url"]').on("blur",function(a){""!=$(this).val()?$(this).closest("label").addClass("filled"):$(this).closest("label").removeClass("filled")});setGooleStaticMap();$(function(){if("undefined"!=typeof plupload&&0<$("#page-teaser-uploader-pickfiles").length){$("#page-teaser-uploader-pickfiles").button();var a=new plupload.Uploader({runtimes:"html5,flash,html4",
browse_button:"page-teaser-uploader-pickfiles",container:"page-teaser-uploader-filelist",max_file_size:"10mb",max_file_count:10,url:$("#website_url").val()+"plugin/widcard/run/uploadLogo",filters:[{title:"image",extensions:"png,jpg,jpeg,gif"}]});a.init();a.bind("FilesAdded",function(a,b){$.each(b,function(a,b){$("#page-teaser-uploader-filelist").prepend('<div class="ui-widget"><div class="ui-state-highlight" id="'+b.id+'"><p>'+b.name+" ("+plupload.formatSize(b.size)+')</p><div class="pbar"></div></div></div>');
$("#"+b.id+" .pbar").progressbar({value:0})});a.refresh();a.start()});a.bind("UploadProgress",function(a,b){$("#"+b.id+" .pbar").progressbar({value:b.percent})});a.bind("FileUploaded",function(a,b,e){a=jQuery.parseJSON(e.response);if(!1==a.error&&a.responseText.hasOwnProperty("src"))$("#page-preview-image").attr("src",a.responseText.src);else{var d="";$.each(a.responseText.data,function(a,b){d+="<p>"+b+"</p>"});smoke.alert(d,{classname:"error"})}})}})});
function checkFields(){var b="",a="organization_name address1 address2 city country_state zip organization_country h1 phone email organization_description logo".split(" "),c="BizOrgName BizAddress1 BizAddress2 BizCity BizState BizZip BizCountry {$website:url} BizTelephone BizEmail BizOrgDesc bizLogo".split(" "),f=a.length;for(i=0;i<f;i++)7==i?""!=$("#"+a[i]).val()&&(b+='<li class="wic_'+a[i]+'">'+c[i]+' => <span class="span_wic_'+a[i]+'"></span></li>'):11==i?b+='<li class="wic_'+a[i]+'">{$plugin:widcard:'+
c[i]+"} => <span class=span_wic_"+a[i]+'><img src="'+$(".img-padding").attr("src")+'" alt="company logo" class="inlineLogo"/></span></li>':""!=$('input[name="'+a[i]+'"]').val()||void 0!=$('textarea[name="'+a[i]+'"]').val()||null!=$('select[name="'+a[i]+'"]').val()?b+='<li class="wic_'+a[i]+'">{$plugin:widcard:'+c[i]+"} => <span class=span_wic_"+a[i]+"></span></li>":b+='<li style="display:none" class="wic_'+a[i]+'">{$plugin:widcard:'+c[i]+"} => <span class=span_wic_"+a[i]+"></span></li>";$("#wic_widgets").html("<ul>"+
b+"</ul>")}
function setGooleStaticMap(){var b=[],a=1;""==$('input[name="address1"]').val()&&""==$('input[name="address2"]').val()||-1==$('select[name="organization_country"]').val()||(-1!=$('select[name="organization_country"] option:selected').val()&&(b[b.length]=$('select[name="organization_country"] option:selected').text()),$('select[name="country_state"] option').length&&(b[b.length]=$('select[name="country_state"] option:selected').text()),""!=$('input[name="city"]').val()&&(b[b.length]=$('input[name="city"]').val()),""!=
$('input[name="address1"]').val()&&(b[b.length]=$('input[name="address1"]').val()),""!=$('input[name="address2"]').val()&&(b[b.length]=$('input[name="address2"]').val()),b=b.join(","),a=14);$("#gMapImg").attr("src","http://maps.googleapis.com/maps/api/staticmap?zoom="+a+"&size=380x255&maptype=roadmap&center="+b+"&markers=color:red|label:G|"+b+"&sensor=false")};
